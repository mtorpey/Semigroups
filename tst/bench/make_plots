#!/usr/bin/env python
# pylint: skip-file

import os
import matplotlib.pyplot as plt
import time
import sys
import numpy as np

#plt.rcParams['font.family'] = 'Times New Roman'

def reject_outliers(data, m=2):
    mean = np.mean(data[0])
    std = np.std(data[0])
    i = 0
    while i < len(data[0]):
        if data[0][i] - mean >= 2 * std:
            del data[0][i]
            del data[1][i]
        else:
            i += 1


def make_plot(filename):
    f = file(filename, 'r')
    lines = f.readlines()
    header = lines[0]
    print header
    data = np.array([np.array(map(float, eval(line.strip())))
                     for line in lines[1:]]) # ignore header
    f.close()

    gap_to_default = data[:,8] / data[:,7]
    gap_to_default.sort()

    X = data[:,0]
    X_string = 'Test number' #'Size of S'
    plt.yscale('log')
#   plt.plot(X, data[:,0], 'rx', label=u'Size of S')
#   plt.plot(X, data[:,1], 'rx', label=u'Number of generating pairs')
#   plt.plot(X, data[:,2], 'rx', label=u'Number of classes')
    plt.plot(X, data[:,3], 'gx', label=u'tc')
    plt.plot(X, data[:,4], 'mx', label=u'tc_prefill')
    plt.plot(X, data[:,5], 'yx', label=u'kbfp')
    plt.plot(X, data[:,6], 'cx', label=u'kbp')
    plt.plot(X, data[:,7], 'rx', label=u'default')
    plt.plot(X, data[:,8], 'bx', label=u'GAP')
    plt.legend(loc='best')
    x1,x2,y1,y2 = plt.axis()
    plt.xlabel(X_string)
    plt.ylabel(u'Time taken compared to default')

    plt.savefig(filename + '.pdf', format='pdf')
    plt.close()

    print 'Number of tests:', len(data)
    print 'Average time taken:', int(np.round(np.mean(data[:,3:]))), "ms"
    total_secs = int(np.round(np.sum(data[:,3:])/1000))
    print 'Total time taken:', total_secs, "sec"
    print '                 ', total_secs/60, "min"
    print '                 ', total_secs/60/60, "hr"
    print 'See: ' + filename + '.pdf'


dir_path = os.path.dirname(os.path.realpath(__file__))
make_plot(dir_path + '/output.csv')
sys.exit(0)
